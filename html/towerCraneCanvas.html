<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>塔吊</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/layui/2.5.6/css/layui.css">
    <script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.js"></script>
    <script src="https://cdn.staticfile.org/layui/2.5.6/layui.js"></script>
    <script src="https://cdn.staticfile.org/layui/2.5.6/lay/modules/table.js"></script>
<!--    <script src="https://cdn.staticfile.org/layui/2.5.6/layui.all.js"></script>-->
    <style>
        .layui-container.canvas {
            width: 1320px;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            min-height: 100vh;
            padding: 10px 30px 40px 30px;
        }

        .circleCanvas, .towerCraneCanvas {
            width: 440px;
            height: 440px;
            border: 1px solid #ccc;
            margin-right: 10px;
        }

        .options {
            width: calc(100% - 900px);
            height: 440px;
        }

        .canvas .projectName {
            font-family: 'Arial Negreta', 'Arial Normal', 'Arial';
            font-weight: 700;
            font-style: normal;
            font-size: 18px;
            text-align: left;
            padding: 10px 0;
        }

        .options .layui-col-md12 {
            height: calc(33.333% - 4px);
            border: 1px solid #ccc;
        }

        .options .layui-col-md12 + .layui-col-md12 {
            margin-top: 6px;
        }

        .projectNameSelect {
            height: 25px;
            line-height: 25px;
            padding: 0px 8px;
            border-color: #0e9ce5;
            color: #0e9ce5;
            margin-left: 10px;
        }

        .projectNameSelect .layui-icon {
            margin-right: 3px;
            font-size: 14px;
            vertical-align: bottom;
            color: #0e9ce5;
        }

        .projectNameSelect.layui-btn-primary:hover {
            border-color: #0e9ce5;
            color: #0e9ce5;
        }

        .options .layui-tab {
            margin: 10px;
        }

        .options .layui-tab-title .layui-this {
            color: #fff;
            background-color: #1094fe;
        }

        .options .layui-tab-title .layui-this:after {
            width: 100%;
            height: 31px;
            border: 0;
        }

        .options .layui-tab-title li {
            font-size: 14px;
            line-height: 30px;
            border: 1px solid #ccc;
        }

        .options .layui-tab-title li + li {
            border-left: 0px solid #ccc;
        }

        .options .layui-tab-title {
            height: 30px;
            border-bottom-width: 0px;
            border-bottom-style: solid;
        }

        .options .layui-card {
            height: 100%;
        }

        .blueLine {
            display: inline-block;
            margin-bottom: -2px;
            height: 15px;
            width: 6px;
            background-color: #0e9ce5;
            margin-right: 5px;
        }

        .voiceSelect {
            width: calc(100% - 186px);
            display: inline-block;
            margin-right: 10px;
        }

        .voiceOpen, .voiceClose {
            display: inline-block;
            height: 38px;
            line-height: 37px;
            border-radius: 5px;
            padding: 0 13px;
            background-color: #c9c9c9;
        }

        .voiceOpen.select-this, .voiceClose.select-this {
            display: inline-block;
            height: 38px;
            line-height: 37px;
            border-radius: 5px;
            background-color: #007BEC;
        }

        .radioDiv {
            display: inline-block;
            width: 24%;
            padding: 3px 0;
        }

        .btnClick .layui-btn {
            margin: 15px 10px 10px 10px;
            width: calc(50% - 22px);
            border-color: #0e9ce5;
            color: #0e9ce5;
        }

        .parameterData {
            width: 890px;
            margin-right: 10px;
        }

        .playControl {
            width: 890px;
            height: 65px;
            margin-right: 10px;
            line-height: 65px;
        }

        .playControl #slidePlayControl {
            display: inline-block;
            width: calc(100% - 405px);
        }

        #slidePlayControl .layui-slider-wrap {
            top: -31px;
        }

        .playControl .startTime, .playControl .endTime, .playControl .player {
            display: inline-block;
            width: 130px;
            text-align: center;
        }

        .player .layui-icon {
            font-size: 22px;
            padding: 0 5px;
            color: #007bec;
            font-weight: bold;
            cursor: pointer;
        }

        .player .layui-icon.layui-icon-play, .player .layui-icon.layui-icon-pause {
            display: none;
        }

        .player .layui-icon.layui-icon-play.show, .player .layui-icon.layui-icon-pause.show {
            display: inline-block;
        }

        .personInfo {
            height: 170px;
            width: calc(100% - 900px);
            border: 1px solid #ccc;
        }

        .personInfoImg {
            text-align: center;
        }

        .personInfoImg img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
        }

        .infoRow {
            height: 35px;
            line-height: 35px;
            font-size: 12px;
            color: #333;
            padding-left: 5px;
        }

        .parameterData .parameter {
            width: calc((100% - 60px) / 7);
            display: inline-block;
            height: 100px;
            text-align: center;
            border: 1px solid #ccc;
        }

        .parameterData .parameter + .parameter {
            margin-left: 3.7px;
        }

        .parameter .title, .parameter .describe, .parameter .data, .parameter .progress {
            height: 25px;
            line-height: 25px;
            width: 80%;
            display: inline-block;
        }

        .parameter .title {
            height: 30px;
            font-family: '微软雅黑 Bold', '微软雅黑 Regular', '微软雅黑';
            font-weight: 700;
            font-style: normal;
            font-size: 16px;
            color: #007BEC;
            line-height: 40px;
        }

        .parameter .describe {
            height: 20px;
            font-family: '微软雅黑';
            font-weight: 400;
            font-style: normal;
            color: #007BEC;
        }

        .parameter .data {
            font-family: 'Arial Negreta', 'Arial Normal', 'Arial';
            font-weight: 700;
            font-style: normal;
            font-size: 18px;
        }

        .parameter .progress .layui-progress-text {
            font-family: 'Arial Normal', 'Arial';
            color: #333333;
        }

        .parameter .layui-progress {
            background-color: rgba(194, 238, 255, 1);
        }

        .parameter .layui-bg-blue {
            background: -webkit-linear-gradient(0deg, rgba(10, 138, 255, 1) 0%, rgba(10, 138, 255, 1) 0%, rgba(42, 194, 250, 1) 100%, rgba(42, 194, 250, 1) 100%);
            background: -moz-linear-gradient(90deg, rgba(10, 138, 255, 1) 0%, rgba(10, 138, 255, 1) 0%, rgba(42, 194, 250, 1) 100%, rgba(42, 194, 250, 1) 100%);
            background: linear-gradient(90deg, rgba(10, 138, 255, 1) 0%, rgba(10, 138, 255, 1) 0%, rgba(42, 194, 250, 1) 100%, rgba(42, 194, 250, 1) 100%);
        }

        .loopList {
            border: 1px solid #ccc;
            width: 480px;
            height: 340px;
            margin-right: 10px;
        }

        .workList {
            border: 1px solid #ccc;
            width: 400px;
            height: 340px;
            margin-right: 10px;
        }

        .deviceInfo {
            border: 1px solid #ccc;
            width: calc(100% - 900px);
            height: 340px;
        }

        .deviceInfo .infoRow:nth-child(odd) {
            background: #f2f9ff;
        }

        .layui-card-header {
            font-weight: bold;
        }

        .loopList .layui-card-header {
            text-align: center;
        }

        .loopList .layui-card-header .layui-icon-left {
            float: left;
            color: #999;
        }

        .loopList .layui-card-header .layui-icon-right {
            float: right;
            color: #999;
        }

        /* 表格样式 */

        .layui-table-view, .layui-table td, .layui-table th {
            border-width: 0;
            border-style: solid;
            border-color: #e6e6e6;
        }

        .layui-table th {
            color: #333;
            font-weight: bold;
        }

        .layui-table tr:nth-child(even) {
            background-color: #f2f9ff;
        }

        .layui-table-header, .layui-table thead tr {
            border: 0;
            background-color: #f2f9ff;
        }

        .layui-table-body::-webkit-scrollbar {
            width: 0px;
            height: 0px;
            color: transparent;
        }
    </style>
</head>

<body>
<div class="layui-container canvas">

    <div class="row projectName">
        工程名称：<span>某某市高级师范学校及中学教育综合体项目</span>
        <button class="layui-btn layui-btn-radius layui-btn-primary projectNameSelect">
            选择&nbsp;<i class="layui-icon layui-icon-search"></i>
        </button>
    </div>

    <div class="row" style="height: 445px;margin-top: 10px;">
        <div class="layui-col-md4 circleCanvas">
            <canvas id="circle-canvas" width="440" height="440">你的版本不支持canvas</canvas>
        </div>
        <div class="layui-col-md4 towerCraneCanvas">
            <canvas id="tower-crane" width="440" height="440">你的版本不支持canvas</canvas>
        </div>
        <div class="layui-col-md4 options">
            <div class="layui-col-md12">
                <div class="layui-tab">
                    <ul class="layui-tab-title">
                        <li class="layui-this">塔式起重机</li>
                        <li>施工升降机</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <div class="radioDiv"><input type="radio">T1塔吊</div>
                            <div class="radioDiv"><input type="radio">T1塔吊</div>
                            <div class="radioDiv"><input type="radio">T1塔吊</div>
                            <div class="radioDiv"><input type="radio">T1塔吊</div>
                            <div class="radioDiv"><input type="radio">T1塔吊</div>
                        </div>
                        <div class="layui-tab-item">
                            <div class="radioDiv"><input type="radio">T1升降机</div>
                            <div class="radioDiv"><input type="radio">T1升降机</div>
                            <div class="radioDiv"><input type="radio">T1升降机</div>
                            <div class="radioDiv"><input type="radio">T1升降机</div>
                            <div class="radioDiv"><input type="radio">T1升降机</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <div class="blueLine"></div>
                        语言播报
                    </div>
                    <div class="layui-card-body layui-form">
                        <div class="voiceSelect">
                            <select name="city" lay-verify="required">
                                <option value="">请选择播报内容</option>
                                <option value="0">木工安全宣传</option>
                                <option value="1">架子工安全宣传</option>
                                <option value="2">钢筋工安全宣传</option>
                            </select>
                        </div>
                        <button class="layui-btn layui-btn-normal voiceOpen select-this">
                            广播&nbsp;<i class="layui-icon layui-icon-speaker" style="font-weight: bold;"></i>
                        </button>
                        <button class="layui-btn layui-btn-normal voiceClose">
                            关闭&nbsp;<i class="layui-icon layui-icon-mute"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12 btnClick">
                <button class="layui-btn layui-btn-primary">实时数据</button>
                <button class="layui-btn layui-btn-primary">视频监控</button>
                <button class="layui-btn layui-btn-primary">报警数据</button>
                <button class="layui-btn layui-btn-primary">历史数据</button>
            </div>
        </div>
    </div>

    <div class="row" style="height: 170px;margin-top: 10px;">
        <div class="layui-col-md8 parameterData">
            <div class="layui-col-md12">
                <div class="parameter">
                    <div class="title">力矩</div>
                    <div class="describe">&nbsp;</div>
                    <div class="data">31.33%</div>
                    <div class="progress">
                        <div class="layui-progress layui-progress-big" lay-showPercent="true">
                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>
                        </div>
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">载重</div>
                    <div class="describe">倍率 2</div>
                    <div class="data">0.942t</div>
                    <div class="progress">
                        <div class="layui-progress layui-progress-big" lay-showPercent="true">
                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>
                        </div>
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">风速</div>
                    <div class="describe">风级 0</div>
                    <div class="data">0.0m/s</div>
                    <div class="progress">
                        <div class="layui-progress layui-progress-big" lay-showPercent="true">
                            <div class="layui-progress-bar layui-bg-blue" lay-percent="0%"></div>
                        </div>
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">幅度</div>
                    <div class="describe">&nbsp;</div>
                    <div class="data">37.5m</div>
                    <div class="progress">
                        <!--                        <div class="layui-progress layui-progress-big" lay-showPercent="true">-->
                        <!--                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>-->
                        <!--                        </div>-->
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">高度</div>
                    <div class="describe">（自顶向下）</div>
                    <div class="data">183m</div>
                    <div class="progress">
                        <!--                        <div class="layui-progress layui-progress-big" lay-showPercent="true">-->
                        <!--                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>-->
                        <!--                        </div>-->
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">回转角度</div>
                    <div class="describe">&nbsp;</div>
                    <div class="data">240°</div>
                    <div class="progress">
                        <!--                        <div class="layui-progress layui-progress-big" lay-showPercent="true">-->
                        <!--                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>-->
                        <!--                        </div>-->
                    </div>
                </div>
                <div class="parameter">
                    <div class="title">塔身斜角</div>
                    <div class="describe">&nbsp;</div>
                    <div class="data">0.00°</div>
                    <div class="progress">
                        <!--                        <div class="layui-progress layui-progress-big" lay-showPercent="true">-->
                        <!--                            <div class="layui-progress-bar layui-bg-blue" lay-percent="31.33%"></div>-->
                        <!--                        </div>-->
                    </div>
                </div>

            </div>
            <div class="layui-col-md12 playControl">
                <div class="startTime">2020-06-01 3:55</div>
                <div id="slidePlayControl"></div>
                <div class="endTime">2020-06-01 5:01</div>
                <div class="player">
                    <i class="layui-icon layui-icon-prev"></i>
                    <i class="layui-icon layui-icon-play show"></i>
                    <i class="layui-icon layui-icon-pause"></i>
                    <i class="layui-icon layui-icon-next"></i>
                </div>
            </div>
        </div>
        <div class="layui-col-md4 personInfo">
            <div class="layui-card-header">
                <div class="blueLine"></div>
                人员信息
            </div>
            <div class="layui-card-body">
                <div class="row">
                    <div class="layui-col-md8">
                        <div class="row infoRow">
                            <div class="layui-col-md6">操作人员：<span>张山</span></div>
                            <div class="layui-col-md6">工号：<span>K156</span></div>
                        </div>
                        <div class="row infoRow">身份证号：<span>441802199506063254</span></div>
                        <div class="row infoRow">联系电话：<span>17688860606</span></div>
                    </div>
                    <div class="layui-col-md4 personInfoImg">
                        <img src="../images/pic05.jpg" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="height: 340px;margin-top: 10px;">
        <div class="layui-col-md4 loopList">
            <div class="layui-card-header">
                <i class="layui-icon layui-icon-left"></i>
                <span>2020-06-01</span>
                <i class="layui-icon layui-icon-right" style="float: right;"></i>
            </div>
            <div class="layui-card-body">
                <table id="loopTable" lay-filter="loopTable"></table>
            </div>
        </div>
        <div class="layui-col-md4 workList">
            <div class="layui-card-header">
                <div class="blueLine"></div>
                作业报警列表
            </div>
            <div class="layui-card-body">
                <table id="workTable" lay-filter="workTable"></table>
            </div>
        </div>
        <div class="layui-col-md4 deviceInfo">
            <div class="layui-card-header">
                <div class="blueLine"></div>
                设备信息
            </div>
            <div class="layui-card-body">
                <div class="row">
                    <div class="layui-col-md12">
                        <div class="row infoRow">上传时间：<span>2020-06-10 16:29:01</span></div>
                        <div class="row infoRow">产权编号：<span>粤A-T02636</span></div>
                        <div class="row infoRow">终端编号：<span>2020020312</span></div>
                        <div class="row infoRow">工地自编号：<span>1#</span></div>
                        <div class="row infoRow">制造单位：<span>三一重工</span></div>
                        <div class="row infoRow">产权单位：<span>某某某租赁单位</span></div>
                        <div class="row infoRow">使用单位：<span>某某某施工单位</span></div>
                        <div class="row infoRow">安监单位：<span>某某某监督站</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

</body>
<script>


    var mCanvas; //声明Canvas对象;
    var cxt; //声明context对象,该对象拥有丰富的绘图的API

    var offCanvas; //声明多级防碰撞Canvas对象;
    var offCxt; //声明多级防碰撞context对象,该对象拥有丰富的绘图的API

    // 塔吊幅度和高度
    var cHeight = 240;
    var cX = 180;
    var cY;

    var changeLeftFn;
    var changeRightFn;
    var changeUpFn;
    var changeDownFn;

    // var styleColor = "rgb(0,123,236)";  // 塔吊颜色统一设置
    var styleColor = "#007bec";

    // 多级防碰撞回转角度
    var r = 80;

    // 多级防碰撞圆形放大倍数
    var circleScale = 1;

    // canvas默认宽高
    var defaultCanvasHeight = 440;
    var defaultCanvasWidth = 440;

    function initMikyouCanvas(mCanvas, cxt) {
        this.mCanvas = mCanvas;
        this.cxt = cxt;
    }

    /**
     * 1、绘制矩形(主要分为:绘制填充矩形和绘制边框矩形和清除矩形区域(利用isClear标记是否绘制清除矩形，实际上就是绘制一个与画布背景色一致的矩形区域),利用isFill变量来标记)
     * 主要使用canvas原生的API:FillRect(x,y,width,height),StrokeRect(x,y,width,height),ClearRect(x,y,width,height)
     * 自己封装的参数:drawRect(x,y,width,height,isClear,isFill,bgColor)
     * x:矩形起点的X坐标(注意：相对坐标系是以画布的左上角为原点，向右为X坐标正方向，向下为Y坐标的正方向)
     * y:矩形终点的Y坐标
     * width:矩形的宽度
     * height:矩形的高度
     * isClear:是否绘制清除画布的矩形区域，true则就是绘制一个清除画布矩形区域，false就是绘制其他两种矩形
     * isFill:是否是填充，false为绘制边框，true为绘制填充
     * bgColor:矩形的颜色，若为填充则为整个矩形背景色，边框则为边框色
     */
    function drawRect(x, y, width, height, isClear, isFill, bgColor) {
        if (isClear) { //为true表示绘制清除画布的矩形区域,那么传入的isFill, bgColor值可以为任意值
            cxt.clearRect(x, y, width, height);
        } else { //false
            if (isFill) { //为true，则绘制填充矩形
                cxt.fillStyle = bgColor;
                cxt.fillRect(x, y, width, height);
            } else { //为false,则绘制边框矩形
                cxt.strokeStyle = bgColor;
                cxt.strokeRect(x, y, width, height);
            }
        }
    }

    /**
     * 2、绘制圆弧(主要分为：绘制填充圆弧和绘制圆弧边框利用isFill变量来标记,注意：在绘制圆弧边框的时候还有一种特殊情况就是，只需要仅仅绘制弧边，不需要绘制圆弧开始起点和终点之间的连线，这个就是调用了beginPath()不需要调用closePath(),这里也使用一个isOnlyArc变量来标记true为仅仅绘制弧边
     *其他的正常)
     * 主要是使用的是canvas原生的API:
     * arc(x,y,radius,startAngle,endAngle,anticlockwise);
     * x:圆心X坐标
     * y:圆心Y坐标
     * startAngle:开始的弧度
     * endAngle:结束的弧度
     * anticlockwise:true为逆时针，false为顺时针
     * 自己封装的参数:drawCircle(x,y,radius,startAngle，endAngle,anticlockwise,isFill，bgColor)
     * x:圆心X坐标
     * y:圆心Y坐标
     * startAngle:开始的角度(通过getAngle方法将传入的角度转换成相应角度的弧度，
     *     因为在原生的绘制圆弧的API它是根据弧度大小来绘制的，例如如果你想绘制一个30度的圆弧，如果直接传入30是不行的，要传入Math.PI/6
     * 所以在这里个人做了一个优化，直接传入30就通过getAngle方法转换成Math.PI/6，这样就很方便的绘制自己传入的角度大小的圆弧。
     * )
     * endAngle:结束的角度
     * 注意:如果要绘制圆形那么只需要调用该方法，传入的startAngle和endAngle是0度和360度即可。
     * anticlockwise:true为逆时针，false为顺时针
     * isFill:是否是填充，false为绘制边框，true为绘制填充
     * bgColor:圆弧的颜色
     */
    function drawArc(x, y, radius, startAngle, endAngle, anticlockwise, isOnlyArc, isFill, bgColor) {
        if (isFill) { //为true绘制填充圆弧
            cxt.fillStyle = bgColor;
            cxt.beginPath();
            cxt.arc(x, y, radius, getAngle(startAngle), getAngle(endAngle), anticlockwise);
            cxt.closePath();
            cxt.fill();
        } else { //为false绘制边框圆弧
            cxt.strokeStyle = bgColor;
            cxt.beginPath();
            cxt.arc(x, y, radius, getAngle(startAngle), getAngle(endAngle), anticlockwise);
            if (isOnlyArc) { //绘制边框的另一种情况就是仅仅绘制弧边不需要调用closePath()

            } else { //否则就是不仅绘制边框还得绘制起点和终点的连线，需要调用了closePath();
                cxt.closePath();
            }
            cxt.stroke();
        }
    }

    /**
     * 3、绘制扇形(主要分为：绘制填充扇形和绘制扇形边框利用isFill变量来标记）
     *主要是使用的是canvas原生的API:
     * arc(x,y,radius,startAngle,endAngle,anticlockwise);
     * x:圆心X坐标
     * y:圆心Y坐标
     * startAngle:开始的弧度
     * endAngle:结束的弧度
     * anticlockwise:true为逆时针，false为顺时针
     * 自己封装参数API:drawSector(x,y,radius,startAngle,endAngle,anticlockwise,isFill,bgColor);
     * x:圆心X坐标
     * y:圆心Y坐标
     * startAngle:开始的角度(通过getAngle方法将传入的角度转换成相应角度的弧度，
     *     因为在原生的绘制圆弧的API它是根据弧度大小来绘制的，例如如果你想绘制一个30度的圆弧，如果直接传入30是不行的，要传入Math.PI/6
     * 所以在这里个人做了一个优化，直接传入30就通过getAngle方法转换成Math.PI/6，这样就很方便的绘制自己传入的角度大小的圆弧。
     * )
     * endAngle:结束的角度
     * anticlockwise:true为逆时针，false为顺时针
     * isFill:是否是填充，false为绘制边框，true为绘制填充
     * bgColor:扇形的颜色
     */
    function drawSector(x, y, radius, startAngle, endAngle, anticlockwise, isFill, bgColor) {
        if (isFill) {
            cxt.fillStyle = bgColor;

            cxt.beginPath();
            cxt.moveTo(x, y); //把路径移动到画布中的指定点，不创建线条，注意：绘制扇形唯一与绘制弧的区别在于，紧跟着beginPath()后面调用，首先将路径移动到圆心位置
            cxt.arc(x, y, radius, getAngle(startAngle), getAngle(endAngle), false);
            cxt.closePath();
            cxt.fill();
        } else {
            cxt.strokeStyle = bgColor;

            cxt.beginPath();
            cxt.moveTo(x, y);
            cxt.arc(x, y, radius, getAngle(startAngle), getAngle(endAngle), false);
            cxt.closePath();
            cxt.stroke();
        }
    }

    /**
     * @description 4、绘制线段(主要分为：绘制填充线段和绘制空心线段利用isFill变量来标记）
     * 主要是使用的是canvas原生的API:
     * lineTo(x,y):表示从某点连线到该坐标点
     *moveTo(x,y):表示将路径移动到画布中的该坐标   点
     * x:画布中某点的X坐标
     * y:画布中某点的Y坐标
     * 注意：如果开始没有调用moveTo,那么第一个lineTo的功能就相当于一个moveTo
     * 自己封装的API:drawLine(startX,startY,endX,endY,lineWidth,bgcolor)
     * 
     * startX:表示线的起点的X坐标
     * startY:表示起点的Y坐标
     * endX:表示线的终点的X坐标
     * endY:表示线的终点的Y坐标
     * lineWidth:表示线段的宽度
     * bgColor:线的颜色
     */
    function drawLine(startX, startY, endX, endY, lineWidth, bgColor) {
        cxt.beginPath();
        cxt.lineWidth = lineWidth;
        cxt.strokeStyle = bgColor;
        cxt.moveTo(startX, startY);
        cxt.lineTo(endX, endY);
        cxt.stroke();
        cxt.fill();
    }

    /**
     * 圆形图中长臂和短臂线段
     */
    function circleDrawLine(startX, startY, endX, endY, lineWidth, bgColor) {
        offCxt.beginPath();
        offCxt.lineWidth = lineWidth;
        offCxt.strokeStyle = bgColor;
        offCxt.moveTo(startX, startY);
        offCxt.lineTo(endX, endY);
        offCxt.stroke();
        offCxt.fill();
    }

    /**
     * @description 5、绘制贝塞尔曲线
     * drawBezierCurve
     */

    //将角度转换成弧度函数，
    function getAngle(arc) {
        return Math.PI * (arc / 180);
    }

    /**
     * @description 6、吊钩
     * variousHooks
     * x原点横坐标,
     * y原点纵坐标,
     * X变量值左右,
     * Y变量值上下,
     * bgColor颜色
     */
    function variousHooks(x, y, X, Y, bgColor, lineWidth) {
        cxt.beginPath();
        if (lineWidth == 2) {
            cxt.lineWidth = 18;
        } else {
            cxt.lineWidth = 1;
        }
        cxt.strokeStyle = bgColor;
        cxt.fillStyle = bgColor;
        //钩子头部分
        // cxt.moveTo(x + 5 + X, y);
        // cxt.lineTo(x + 35 + X, y);
        cxt.moveTo(x + 5 + X, y + 10);
        cxt.lineTo(x + 35 + X, y + 10);
        cxt.moveTo(x + 10 + X, y + 1);
        cxt.lineTo(x + 10 + X, y + 10);
        cxt.moveTo(x + 30 + X, y + 1);
        cxt.lineTo(x + 30 + X, y + 10);
        cxt.moveTo(x + 11 + X, y + 10);
        cxt.lineTo(x + 11 + X, y + 10 + Y);
        cxt.moveTo(x + 29 + X, y + 10);
        cxt.lineTo(x + 29 + X, y + 10 + Y);
        //半圆
        cxt.moveTo(x + 20 + X, y + 10 + Y);
        cxt.arc(x + 20 + X, y + 10 + Y, 10, 0, 180 * Math.PI / 180, false);
        cxt.moveTo(x + 20 + X, y + 10 + Y + 5);
        cxt.lineTo(x + 10 + X, y + 10 + Y + 15);
        cxt.moveTo(x + 20 + X, y + 10 + Y + 5);
        cxt.lineTo(x + 30 + X, y + 10 + Y + 15);
        cxt.moveTo(x + 30 + X, y + 10 + Y + 15);
        cxt.lineTo(x + 30 + X, y + 10 + Y + 35);
        cxt.lineTo(x + 10 + X, y + 10 + Y + 35);
        cxt.lineTo(x + 10 + X, y + 10 + Y + 35);
        cxt.lineTo(x + 10 + X, y + 10 + Y + 15);
        cxt.lineTo(x + 30 + X, y + 10 + Y + 15);
        cxt.stroke();
        cxt.fill();
    }

    /**
     * 塔吊臂长转动区域
     * 圆心坐标: (x, y)
     * 半径: radius
     * 起始角度: startAngle
     * 结束角度: endAngle
     * 是否逆时针旋转: false 代表顺时针旋转
     */
    function circleRender(x, y, radius, startAngle, endAngle, color, fillStyle, Boolean) {
        drawDashRound(x, y, radius,);
        offCxt.beginPath();
        offCxt.arc(x, y, radius, startAngle * Math.PI / 180, endAngle * Math.PI / 180);
        if (fillStyle) {
            offCxt.fillStyle = fillStyle;
            offCxt.fill();
        }
        offCxt.closePath();

    }

    /**
     * 虚线圆
     */
    function drawDashRound(x, y, radius, step = 2) {
        offCxt.strokeStyle = "#007bec36";
        step = step / 180 * Math.PI * 2;
        for (let b = 0, e = step / 2; e <= 360; b += step, e += step) {
            offCxt.beginPath();
            offCxt.lineWidth = 1;
            offCxt.arc(x, y, radius, b, e);
            offCxt.stroke();
        }
    }

    /**
     * 十字虚线
     */
    function drawDashLine(ctx, x1, y1, x2, y2, dashLength) {
        var dashLen = dashLength === undefined ? 5 : dashLength,
            xpos = x2 - x1, //得到横向的宽度;
            ypos = y2 - y1, //得到纵向的高度;
            numDashes = Math.floor(Math.sqrt(xpos * xpos + ypos * ypos) / dashLen);
        //利用正切获取斜边的长度除以虚线长度，得到要分为多少段;
        for (var i = 0; i < numDashes; i++) {
            if (i % 2 === 0) {
                ctx.moveTo(x1 + (xpos / numDashes) * i, y1 + (ypos / numDashes) * i);
                //有了横向宽度和多少段，得出每一段是多长，起点 + 每段长度 * i = 要绘制的起点；
            } else {
                ctx.lineTo(x1 + (xpos / numDashes) * i, y1 + (ypos / numDashes) * i);
            }
        }
        ctx.stroke();
    }

    /**
     * 塔吊转动区域黄色区域
     */
    function circleYellowRender(x, y, radius, startAngle, endAngle, color, Boolean) {
        offCxt.beginPath();
        offCxt.strokeStyle = color;
        offCxt.arc(x, y, radius, startAngle * Math.PI / 180, endAngle * Math.PI / 180);
        // offCxt.lineTo(x,y);
        offCxt.fillStyle = color;
        offCxt.stroke();
        offCxt.fill();
        offCxt.closePath();
    }

    /**
     * 塔吊转动区域长臂短臂
     */
    function circleLineRender(x, y, radius, startAngle, endAngle, color, Boolean) {
        offCxt.beginPath();
        offCxt.strokeStyle = color;
        offCxt.arc(x, y, radius, startAngle * Math.PI / 180, endAngle * Math.PI / 180);
        offCxt.lineTo(x, y);
        offCxt.fillStyle = color;
        offCxt.stroke();
        offCxt.fill();
        offCxt.closePath();
    }

    /**
     * 圆上点坐标计算
     */
    function circlePoint(x, y, radius, angle) {
        var x1 = x + radius * Math.cos(getAngle(angle));
        var y1 = y + radius * Math.sin(getAngle(angle));
        return {x: x1, y: y1}
    }

    /**
     * 两点之间距离计算
     */
    function GetDistance(lat1, lng1, lat2, lng2) {
        var xdiff = lat2 - lat1; // 计算两个点的横坐标之差
        var ydiff = lng2 - lng1; // 计算两个点的纵坐标之差
        return Math.pow((xdiff * xdiff + ydiff * ydiff), 0.5);
    }

    /**
     * 塔机转动区域长臂短臂
     */
    function circleLine(x, y, longRadius, shortRadius, angle, fillStyle) {
        // x+=250;
        // y = 500 - y;
        var point1 = circlePoint(x, y, longRadius, angle);
        var point2 = circlePoint(x, y, shortRadius, angle + 180);
        circleDrawLine(x, y, point1.x, point1.y, 5, "#007bec");
        circleDrawLine(x, y, point2.x, point2.y, 5, "#007bec");
    }

    /**
     * 绘制塔吊载重幅度区域
     */
    function loadRange() {
        // 模拟数据
        var range = [2.5, 39.2, 40, 42.5, 45, 47.5, 50, 52.5, 55, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        var load = [3000, 3000, 2950, 2740, 2550, 2380, 2220, 2090, 1960, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        var rangeNow = 40;
        var loadNow = 500;

        // 计算等比例倍数缩放
        var rangeMax = Math.max.apply(null, range);
        var rangeScale = 200 / rangeMax;
        var rangeScale2 = 180 / rangeMax;
        var loadMax = Math.max.apply(null, load);
        var loadScale = 180 / loadMax;
        var loadScale2 = 160 / loadMax;

        // 数据处理
        var range2 = [], load2 = [];
        range = range.map(function (i) {
            range2.push(i * rangeScale2);
            return i * rangeScale;
        });
        load = load.map(function (i) {
            load2.push(i * loadScale2);
            return i * loadScale;
        });
        var arr = [[0, 0], [0, loadMax * loadScale]];
        var arr2 = [[0, loadMax * loadScale2]];
        range.forEach(function (i, index) {
            if (i == 0 && load[index] == 0) {
                return false;
            }
            arr.push([i, load[index]]);
            arr2.push([range2[index], load2[index]]);
        });
        arr.push([rangeMax * rangeScale, 0], [0, 0]);
        arr2.push([rangeMax * rangeScale2, 0]);

        // 黄色区域
        cxt.beginPath();
        cxt.lineWidth = 1;
        cxt.strokeStyle = "#ffc107";
        // cxt.moveTo(arr[0], arr[1]);
        arr2.forEach(function (j) {
            cxt.lineTo(200 + j[0], -j[1] + 400);
        });
        cxt.stroke();

        // 蓝色区域
        cxt.beginPath();
        cxt.lineWidth = 1;
        cxt.strokeStyle = styleColor;
        // cxt.moveTo(arr[0], arr[1]);
        arr.forEach(function (j) {
            cxt.lineTo(200 + j[0], -j[1] + 400);
        });
        cxt.stroke();

        // 载重与幅度矩形区域
        cxt.beginPath();
        cxt.lineWidth = 1;
        cxt.fillStyle = "#0073e877";
        cxt.lineTo(200, 400);
        cxt.lineTo(200, -loadNow * loadScale + 400);
        cxt.lineTo(200 + rangeNow * rangeScale, -loadNow * loadScale + 400);
        cxt.lineTo(200 + rangeNow * rangeScale, 400);
        cxt.lineTo(200, 400);
        cxt.fill();
    }

    /**
     * @description 7、叉线
     * wiredCables
     */
    function wiredCables(x, y, lineWidth, bgColor) {
        cxt.beginPath();
        cxt.lineWidth = lineWidth;
        cxt.strokeStyle = bgColor;
        cxt.moveTo(x - 10, y + 15);
        cxt.lineTo(x + 10, y - 15);
        cxt.moveTo(x - 10, y - 15);
        cxt.lineTo(x + 10, y + 15);
        cxt.stroke();
        cxt.fill();
    }

    /**
     * @description 8、文字
     * wiredCables
     */
    function drawText(text, x, y, color, font, textAlign) {
        cxt.font = font;
        cxt.textAlign = textAlign;
        cxt.fillStyle = color;
        cxt.fillText(text, x, y);
    }

    function drawOffCxtText(text, x, y, color, font, textAlign) {
        offCxt.font = font;
        offCxt.textAlign = textAlign;
        offCxt.fillStyle = color;
        offCxt.fillText(text, x, y);
    }

    function initCanvas() { //onload事件加载该方法，当HTML5页面加载的时候就会回调该方法

        cxt.clearRect(0, 0, mCanvas.width, mCanvas.height);

        //初始化Canvas
        initMikyouCanvas(mCanvas, cxt);
        /**canvas各种绘图的API**/
        //1、绘制矩形，drawRect(x,y,width,height,isClear,isFill,bgColor);
        drawRect(150, 370, 20, 30, false, false, styleColor);
        drawRect(150, 340, 20, 30, false, false, styleColor);
        drawRect(150, 310, 20, 30, false, false, styleColor);
        drawRect(150, 280, 20, 30, false, false, styleColor);
        drawRect(150, 250, 20, 30, false, false, styleColor);
        drawRect(150, 220, 20, 30, false, false, styleColor);
        drawRect(150, 190, 20, 30, false, false, styleColor);
        drawRect(150, 160, 20, 30, false, false, styleColor);
        drawRect(150, 155, 20, 5, false, false, styleColor);
        drawRect(150, 110, 20, 5, false, false, styleColor);
        drawRect(150, 110, 1, 50, false, false, styleColor);
        drawRect(150, 115, 10, 40, false, true, styleColor);
        //左小重物
        drawRect(57, 113, 9, 15, false, true, styleColor);
        drawRect(67, 113, 9, 15, false, true, styleColor);
        drawRect(77, 113, 9, 15, false, true, styleColor);
        //3、绘制圆形
        //支柱交点
        drawArc(150, 400, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 370, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 340, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 310, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 280, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 250, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 220, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 190, 2, 0, 360, false, false, true, styleColor);
        drawArc(150, 160, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 400, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 370, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 340, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 310, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 280, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 250, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 220, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 190, 2, 0, 360, false, false, true, styleColor);
        drawArc(170, 160, 2, 0, 360, false, false, true, styleColor);
        //5、绘制线段 drawLine(startX, startY, endX, endY, lineWidth,bgColor)
        drawLine(110, 400, 210, 400, 1, styleColor);
        drawLine(135, 400, 150, 340, 1, styleColor);
        drawLine(185, 400, 170, 340, 1, styleColor);
        //驾驶室
        drawLine(160, 115, 170, 115, 1, styleColor);
        drawLine(170, 115, 180, 135, 1, styleColor);
        drawLine(180, 135, 160, 135, 1, styleColor);
        drawLine(180, 135, 170, 155, 1, styleColor);
        drawLine(170, 155, 160, 155, 1, styleColor);
        //塔吊尖
        drawLine(150, 110, 170, 110, 1, styleColor);
        drawLine(150, 110, 160, 20, 1, styleColor);
        drawLine(170, 110, 160, 20, 1, styleColor);
        drawLine(152, 90, 168, 90, 1, styleColor);
        drawLine(155, 70, 165, 70, 1, styleColor);
        drawLine(158, 50, 162, 50, 1, styleColor);

        drawLine(160, 45, 85, 80, 1, styleColor);
        drawLine(160, 45, 88, 80, 1, styleColor);
        drawLine(160, 45, 91, 80, 1, styleColor);

        drawLine(160, 45, 240, 90, 1, styleColor);
        drawLine(160, 45, 243, 90, 1, styleColor);
        drawLine(160, 45, 246, 90, 1, styleColor);
        drawLine(160, 45, 350, 90, 1, styleColor);
        drawLine(160, 45, 353, 90, 1, styleColor);
        drawLine(160, 45, 356, 90, 1, styleColor);
        //右臂上下线条
        drawLine(170, 110, 390, 110, 1, styleColor);
        drawLine(180, 90, 380, 90, 1, styleColor);

        //上下线见得线    比例1:2
        drawLine(170, 110, 180, 90, 1, styleColor);
        drawLine(190, 110, 180, 90, 1, styleColor);
        drawLine(190, 110, 200, 90, 1, styleColor);
        drawLine(210, 110, 200, 90, 1, styleColor);
        drawLine(210, 110, 220, 90, 1, styleColor);
        drawLine(230, 110, 220, 90, 1, styleColor);
        drawLine(230, 110, 240, 90, 1, styleColor);
        drawLine(250, 110, 240, 90, 1, styleColor);
        drawLine(250, 110, 260, 90, 1, styleColor);
        drawLine(270, 110, 260, 90, 1, styleColor);
        drawLine(270, 110, 280, 90, 1, styleColor);
        drawLine(290, 110, 280, 90, 1, styleColor);
        drawLine(290, 110, 300, 90, 1, styleColor);
        drawLine(310, 110, 300, 90, 1, styleColor);
        drawLine(310, 110, 320, 90, 1, styleColor);
        drawLine(330, 110, 320, 90, 1, styleColor);
        drawLine(330, 110, 340, 90, 1, styleColor);
        drawLine(350, 110, 340, 90, 1, styleColor);
        drawLine(350, 110, 360, 90, 1, styleColor);
        drawLine(370, 110, 360, 90, 1, styleColor);
        drawLine(370, 110, 380, 90, 1, styleColor);
        drawLine(390, 110, 380, 90, 1, styleColor);

        //左吊臂
        drawLine(55, 110, 150, 110, 1, styleColor);
        drawLine(55, 110, 55, 80, 1, styleColor);
        drawLine(85, 110, 85, 80, 1, styleColor);
        drawLine(115, 110, 115, 80, 1, styleColor);
        drawLine(145, 110, 145, 80, 1, styleColor);
        drawLine(55, 100, 145, 100, 1, styleColor);
        drawLine(55, 90, 145, 90, 1, styleColor);
        drawLine(55, 80, 145, 80, 1, styleColor);

        //左小重物竖线
        drawLine(62, 110, 62, 130, 1, styleColor);
        drawLine(72, 110, 72, 130, 1, styleColor);
        drawLine(82, 110, 82, 130, 1, styleColor);

        //6.控制吊钩的运动  以(165,110)为原点  X~(0--180),Y~(0--240)
        variousHooks(165, 110, cX, cHeight, styleColor);
        $("#curX").val(cX);
        $("#curY").val(cHeight);
        // variousHooks(165, 110, 180, 240, "#fff");

        //7.绘制叉线    y递减30
        wiredCables(160, 385, 1, styleColor);
        wiredCables(160, 355, 1, styleColor);
        wiredCables(160, 325, 1, styleColor);
        wiredCables(160, 295, 1, styleColor);
        wiredCables(160, 265, 1, styleColor);
        wiredCables(160, 235, 1, styleColor);
        wiredCables(160, 205, 1, styleColor);
        wiredCables(160, 175, 1, styleColor);
        // wiredCables(160, 145, 1, styleColor);
        //8 吊钩区域文字
        drawText('尾臂长', 65, 55, "#333", '13px 微软雅黑', "center");
        drawText('14m', 65, 70, "#333", '13px 微软雅黑', "center");
        drawText('塔身高', 80, 150, "#333", '13px 微软雅黑', "center");
        drawText('247m', 80, 165, "#333", '13px 微软雅黑', "center");
        drawText('臂长', 380, 60, "#333", '13px 微软雅黑', "center");
        drawText('61.74m', 380, 75, "#333", '13px 微软雅黑', "center");
        drawText('载重', 185, 235, "#333", '13px 微软雅黑', "center");
        drawText('幅度', 370, 415, "#333", '13px 微软雅黑', "center");

        //9 绘制塔吊载重幅度区域
        loadRange();
    }

    function initoffCanvas(arr) {

        offCxt.clearRect(0, 0, offCanvas.width, offCanvas.height);

        // 多级防碰撞
        // circleYellowRender(x, y, radius, startAngle, endAngle,color, Boolean)
        // circleRender(x, y, radius, startAngle, endAngle,color, fillStyle, Boolean)

        arr.forEach(function (i) {
            circleLine(i.x, i.y, i.radius, i.shortRadius, i.angle, i.fillStyle);
        });

        arr.forEach(function (i) {
            drawOffCxtText(i.name, i.x, i.y + 30, "#0099ff", '15px 微软雅黑', "center");
        });

        arr.forEach(function (i, index) {
            circleRender(i.x, i.y, i.radius, 0, 360, "#999", i.fillStyle);
            circleRender(i.x, i.y, 5, 0, 360, "#999", "#fff");
            if (index == 0) {
                drawDashLine(offCxt, i.x, 0, i.x, defaultCanvasHeight);
                drawDashLine(offCxt, 0, i.y, defaultCanvasWidth, i.y);
            }
        });


    }

    window.onload = function () {

        //注意：选项卡 依赖 element 模块，否则无法进行功能性操作
        layui.use(['element', 'form', 'slider'], function () {
            var element = layui.element,
                form = layui.form,
                slider = layui.slider,
                table = layui.table;

            form.render();

            //渲染
            slider.render({
                elem: '#slidePlayControl'
                , value: 20 //初始值
                , theme: '#1E9FFF' //主题色
                , min: 3 * 60 + 55
                , max: 5 * 60 + 1
                , setTips: function (value) { //自定义提示文本
                    var m = Math.floor(value / 60);
                    var s = value - m * 60;
                    if (s < 10) {
                        s = "0" + s
                    }
                    return m + ":" + s;
                }
            });

            // 模拟数据
            var loopData = [
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: true},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: true},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: true},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: true},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false},
                {id: 6663506, startTime: "10:59:47", endTime: "11:10:12", alarm: false}
            ];

            var workData = [
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"},
                {id: 6663506, startTime: "10:59:47", alarmInfo: "XX报警"}
            ];

            table.render({
                elem: '#loopTable'
                , height: 260
                // ,url: '/demo/table/user/' //数据接口
                , data: loopData
                , page: false //开启分页
                , cols: [[ //表头
                    {
                        field: 'id',
                        title: '循环序号',
                        align: 'center',
                        templet: function (d) {
                            if (d.alarm) {
                                return '<span style="color: red">' + d.id + '</span>'
                            } else {
                                return d.id
                            }
                        }
                    },
                    {
                        field: 'startTime',
                        title: '开始时间',
                        align: 'center',
                        templet: function (d) {
                            if (d.alarm) {
                                return '<span style="color: red">' + d.startTime + '</span>'
                            } else {
                                return d.startTime
                            }
                        }
                    },
                    {
                        field: 'endTime',
                        title: '结束时间',
                        align: 'center',
                        templet: function (d) {
                            if (d.alarm) {
                                return '<span style="color: red">' + d.endTime + '</span>'
                            } else {
                                return d.endTime
                            }
                        }
                    },
                    {
                        title: '操作',
                        align: 'center',
                        templet: function (d) {
                            return '<span style="color: #007BEC;cursor: pointer">播放</span>'
                        }
                    }
                ]]
            });

            table.render({
                elem: '#workTable'
                , height: 260
                // ,url: '/demo/table/user/' //数据接口
                , data: workData
                , page: false //开启分页
                , cols: [[ //表头
                    {
                        type: 'numbers',
                        title: '序号',
                        align: 'center',
                        width: '33%'
                    },
                    {
                        field: 'startTime',
                        title: '发生时间',
                        align: 'center',
                        width: '33%'
                    },
                    {
                        field: 'alarmInfo',
                        title: '报警信息',
                        align: 'center',
                        width: '33%'
                    }
                ]]
            });

            //监听行单击事件
            table.on('row(loopTable)', function(obj){
                console.log(obj.tr) //得到当前行元素对象
                console.log(obj.data) //得到当前行数据
                debugger
                //obj.del(); //删除当前行
                //obj.update(fields) //修改当前行数据
            });

        });



        // 监听点击事件
        $(document).on("click", ".voiceOpen", function () {
            $(this).addClass("select-this");
            $(".voiceClose").removeClass("select-this");
        });
        $(document).on("click", ".voiceClose", function () {
            $(this).addClass("select-this");
            $(".voiceOpen").removeClass("select-this");
        });

        $(document).on("click", ".layui-icon-play", function () {
            $(this).removeClass("show");
            $(".layui-icon-pause").addClass("show");
        });
        $(document).on("click", ".layui-icon-pause", function () {
            $(this).removeClass("show");
            $(".layui-icon-play").addClass("show");
        });


        mCanvas = document.getElementById("tower-crane"); //初始化canvas对象,这里只是获得了Canvas的这个整个的标签---<canvas id="mCanvas" width="500" height="500"></canvas>
        cxt = mCanvas.getContext("2d"); //初始化cxt对象,然后就去获得canvas的上下文对象cxt,注意传入参数为2d表示绘制2d平面，cxt得到的是一个canvasRenderingContext2D对象，里面封装了大量的canvas绘图API

        offCanvas = document.getElementById("circle-canvas"); //初始化canvas对象,这里只是获得了Canvas的这个整个的标签---<canvas id="circle-canvas" width="500" height="500"></canvas>
        offCxt = offCanvas.getContext("2d"); //初始化cxt对象,然后就去获得canvas的上下文对象cxt,注意传入参数为2d表示绘制2d平面，cxt得到的是一个canvasRenderingContext2D对象，里面封装了大量的canvas绘图API


        /**
         * websocket实时数据
         */

            // 初始化WebSocket对象
        var ws = new WebSocket("ws://localhost:8080/");

        // mousemoveEvent鼠标事件
        var mousemoveEvent = false;

        ws.onopen = function () {
            console.log("Conncet open");
            // 发送消息
            ws.send(JSON.stringify({id: 123}));
        };

        ws.onmessage = function (evt) {
            var arr = JSON.parse(evt.data);
            // 计算放大倍数，处理数据
            arr = setCircleScale(arr);
            initoffCanvas(arr);
            // 监听多级防碰撞鼠标事件
            var points = arr;//原点圆心集合
            var cP = getLeftRight(offCanvas);//offCanvas
            var timer;
            // 鼠标事件
            if (!mousemoveEvent) {
                offCanvas.addEventListener('mousemove', function (e) {
                    mousemoveEvent = true;
                    clearTimeout(timer);
                    var x = e.clientX, y = e.clientY;
                    timer = setTimeout(function () {
                        for (var i = 0; i < points.length; i++) {
                            if (hitCheck(x - cP.x, y - cP.y, points[i], points[i].radius)) {
                                // initoffCanvas(arr);
                                // drawOffCxtText( points[i].name,  points[i].x,points[i].y, "#666", '15px 微软雅黑', "left");
                                return;
                            } else {
                                // initoffCanvas(arr);
                            }
                        }
                    }, 100);
                }, false);
            }

        };

        ws.onclose = function () {
            console.log("Connect close");
        };

        // 模拟数据
        // x横坐标 y纵坐标 radius长臂（半径） shortRadius短臂 startAngle开始角度 endAngle结束角度 angle回转角度
        let arr = [
            {name:'T1塔吊',x:175,y:114,radius:55,shortRadius:14,startAngle:0,endAngle:360,angle: angle1},
            {name:'T2塔吊',x:227,y:188,radius:55,shortRadius:14,startAngle:0,endAngle:360,angle: angle2}
        ];

        // 计算放大倍数，处理数据
        arr = setCircleScale(arr);
        initoffCanvas(arr);
        // 监听多级防碰撞鼠标事件
        var points = arr;//原点圆心集合
        var cP = getLeftRight(offCanvas);//offCanvas
        var timer;
        // 鼠标事件
        if (!mousemoveEvent) {
            offCanvas.addEventListener('mousemove', function (e) {
                mousemoveEvent = true;
                clearTimeout(timer);
                var x = e.clientX, y = e.clientY;
                timer = setTimeout(function () {
                    for (var i = 0; i < points.length; i++) {
                        if (hitCheck(x - cP.x, y - cP.y, points[i], points[i].radius)) {
                            // initoffCanvas(arr);
                            // drawOffCxtText( points[i].name,  points[i].x,points[i].y, "#666", '15px 微软雅黑', "left");
                            return;
                        } else {
                            // initoffCanvas(arr);
                        }
                    }
                }, 100);
            }, false);
        }

        initCanvas();

    };


    function changeLeft(x) {
        clearTimeout(changeLeftFn);
        clearTimeout(changeRightFn);
        changeLeftFn = setInterval(function () {
            if ((x && cX == x) || cX == 0) {
                clearTimeout(changeLeftFn);
                return false;
            }
            // cHeight = cHeight - 1;
            cX = cX - 1;
            initCanvas()
        }, 40)
    }

    function changeRight(x) {
        clearTimeout(changeLeftFn);
        clearTimeout(changeRightFn);
        changeRightFn = setInterval(function () {
            if (x && cX == 0) {
                clearTimeout(changeRightFn);
                return false;
            }
            // cHeight = cHeight - 1;
            cX = cX + 1;
            initCanvas()
        }, 40)
    }

    function changeUp(y) {
        clearTimeout(changeUpFn);
        clearTimeout(changeDownFn);
        changeUpFn = setInterval(function () {
            if ((y && cHeight == y) || cHeight == 0) {
                clearTimeout(changeUpFn);
                return false;
            }
            cHeight = cHeight - 1;
            // cX = cX - 1;
            initCanvas()
        }, 40)
    }

    function changeDown(y) {
        clearTimeout(changeUpFn);
        clearTimeout(changeDownFn);
        changeDownFn = setInterval(function () {
            if (y && cHeight == y) {
                clearTimeout(changeDownFn);
                return false;
            }
            cHeight = cHeight + 1;
            // cX = cX - 1;
            initCanvas()
        }, 40)
    }

    // 移动
    function moveTo(x, y) {

        var curX = parseInt($("#curX").val());
        var curY = parseInt($("#curY").val());

        x = parseInt($("#toX").val());
        y = parseInt($("#toY").val());
        if (x > curX) {
            changeRight(x)
        } else {
            changeLeft(x)
        }
        if (y > curY) {
            changeDown(y)
        } else {
            changeUp(y)
        }

    }

    function changeCancel() {
        clearTimeout(changeLeftFn);
        clearTimeout(changeRightFn);
        clearTimeout(changeUpFn);
        clearTimeout(changeDownFn);
    }

    /**
     * 计算多级防碰撞圆形放大倍数，初始化数据
     */
    function setCircleScale(arr) {
        arr = arr || [];
        if (arr.length == 1) {
            // 计算能放大的最小倍率
            var scale1 = defaultCanvasHeight / (arr[0].radius * 2);
            var scale2 = defaultCanvasWidth / (arr[0].radius * 2);
            circleScale = scale1 < scale2 ? scale1 : scale2;
            // 数据按倍率放大初始化数据
            arr = arr.map(function (i) {
                return {
                    name: i.name,
                    x: defaultCanvasWidth / 2,
                    y: defaultCanvasHeight / 2,
                    radius: defaultCanvasWidth / 2,
                    shortRadius: i.shortRadius * circleScale,
                    startAngle: 0,
                    endAngle: 360,
                    fillStyle: "#007bec36",
                    angle: i.angle - 90
                };
            })
        } else {
            var xArr = [], yArr = [];
            arr.forEach(function (i) {
                xArr.push({x: i.x, radius: i.radius});
                yArr.push({y: i.y, radius: i.radius});
            });
            xArr = xArr.sort(function (a, b) {
                return a.x - b.x
            });
            yArr = yArr.sort(function (a, b) {
                return a.y - b.y
            });
            // 计算能放大的最小倍率
            var scale = [];
            for (var i = 0; i < xArr.length; i++) {
                for (var j = i + 1; j < xArr.length; j++) {
                    scale.push(defaultCanvasWidth / (xArr[j].x - xArr[i].x + xArr[j].radius + xArr[i].radius));
                    scale.push(defaultCanvasHeight / (yArr[j].y - yArr[i].y + yArr[j].radius + yArr[i].radius));
                }
            }
            scale = scale.sort();
            circleScale = scale[0];
            // 坐标平移量
            var translationX = circleScale * xArr[0].x - xArr[0].radius * circleScale;
            var translationY = circleScale * yArr[0].y - yArr[0].radius * circleScale;
            arr = arr.map(function (i, index) {
                return {
                    name: i.name,
                    x: i.x * circleScale - translationX,
                    y: defaultCanvasHeight - (i.y * circleScale) + translationY,
                    radius: i.radius * circleScale,
                    shortRadius: i.shortRadius * circleScale,
                    startAngle: 0,
                    endAngle: 360,
                    fillStyle: index == 0 ? "#007bec36" : "#e3f0fcc7",
                    angle: i.angle - 90
                };
            })
        }
        return arr;
    }

    /**
     * 格式化时间
     * fmt: 'yyyy', 'yyyy-MM-dd', 'yy-MM-dd', 'yyyy-MM-dd hh:mm:ss'
     */
    function formatDate(date, fmt) {
        if (!date) {
            return '';
        }
        if (typeof date == 'string') {
            return date;
        }
        date = new Date(date);
        if (!fmt) fmt = "yyyy-MM-dd hh:mm:ss";

        if (!date || date == null) return null;
        var o = {
            'M+': date.getMonth() + 1, // 月份
            'd+': date.getDate(), // 日
            'h+': date.getHours(), // 小时
            'm+': date.getMinutes(), // 分
            's+': date.getSeconds(), // 秒
            'q+': Math.floor((date.getMonth() + 3) / 3), // 季度
            'S': date.getMilliseconds() // 毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));
        for (var k in o) {
            if (new RegExp('(' + k + ')').test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length)))
        }
        return fmt
    }

    function getLeftRight(o) {
        var p = {x: o.offsetLeft, y: o.offsetTop};
        while (o = o.offsetParent) {
            p.x += o.offsetLeft;
            p.y += o.offsetTop;
        }
        return p;
    }

    function hitCheck(x, y, point, r) {//检查是否移动到点上，直接按照正方形检查了，圆形比较麻烦
        var x1 = point.x, y1 = point.y;
        var length = GetDistance(x, y, x1, y1);
        console.log(length);
        return length <= r;
    }

</script>

</html>